<div class="page-container" style="height: 100%">
    <md-app md-waterfall md-mode="fixed">
        <md-app-toolbar class="md-primary">
            <span class="md-title">PharmaChain</span><span class="md-body-1" style="margin-top: 2px; margin-left: 7px">â”ƒ Doctor</span>
        </md-app-toolbar>

        <md-app-content>
            <!-- Login Area -->
            <div>
                <div style="margin: 150px" v-if="!patient.is_signed_in">
                    <md-card md-with-hover md-medium>
                        <md-ripple>
                            <md-card-header>
                                <div class="md-title">Create a receipt</div>
                            </md-card-header>

                            <md-card-content>
                                <md-field>
                                    <label>Doctor ID</label>
                                    <md-input v-model="doctor_id"></md-input>
                                </md-field>
                            </md-card-content>

                            <md-card-content>
                                <md-field>
                                    <label>Patient ID</label>
                                    <md-input v-model="patient.id"></md-input>
                                </md-field>
                            </md-card-content>
                            <md-card-actions>
                                <md-button v-on:click="set_patient()">OK</md-button>
                            </md-card-actions>
                        </md-ripple>
                    </md-card>
                </div>

                <!-- Create Receipt Area -->
                <div v-if="patient.is_signed_in">
                    <div class="md-layout">
                        <!-- Patient Window -->
                        <div class="md-layout-item md-size-30" style="max-width: 200px">
                            <md-card>
                                <md-card-media style="text-align: center; padding-top: 40px">
                                    <!-- TODO Download, add reference to source, copyright? -->
                                    <img style=" width: 150px; border-radius: 150px;"
                                         src="https://encrypted-tbn0.gstatic.com/images?q=tbn:ANd9GcTsAUelg7yg0mepGMf-N93hh6E9XrLnKwsKa4YEQ6swhDknk4F9eQ"
                                         alt="People">
                                </md-card-media>

                                <md-card-header>
                                    <div class="md-title">{{patient.firstName}} {{patient.lastName}}</div>
                                    <div class="md-subhead">Birthday: {{patient.birthday}}</div>
                                    <!-- TODO Add method to get name of insurance from API -->
                                    <!-- <div class="md-subhead">Insurance: {{patient.insurance}}</div> -->
                                </md-card-header>

                                <md-card-content>
                                    Balance: {{patient.money}} </br>
                                </md-card-content>
                            </md-card>
                        </div>
                        <!-- List all receipts for this patient -->
                        <div class="md-layout-item">
                            <p class="md-display-2" style="margin: 15px">Receipts</p>
                            <template v-for="receipt in receipts">
                                <!-- TODO REMOVE? -->
                                <md-card style="margin-bottom: 15px;">
                                    <div>
                                        <md-card-content style="padding-bottom: 5px">
                                            <p class="md-title">{{receipt.name}}</p>
                                            <p class="md-body-1">Dosage: {{receipt.dosage}}</p>
                                            <p class="md-body-1">Quantity: {{receipt.quantity}}</p>
                                            <p class="md-body-1">Presribed at: {{receipt.createdAt_moment}}</p>
                                            <!-- TODO Should a doctor be allowed to see the state of the receipt? -->
                                            <md-badge v-if="receipt.state.toString()==='open'" class="md-square"
                                                      md-content="Active"
                                                      style="background: green; top: 15px; right: 15px">
                                            </md-badge>
                                        </md-card-content>
                                    </div>
                                </md-card>

                            </template>
                        </div>
                    </div>
                </div>

            </div>

            <!-- Modal dialog to create a receipt -->
            <!-- TODO Refactor into Component -->
            <md-dialog :md-active.sync="showDialog">
                <md-dialog-title>New receipt</md-dialog-title>

                <md-dialog-content>
                    <div class="md-layout-item">
                        <md-field>
                            <label>Medication</label>
                            <md-select v-model="new_prescription.name" v-on:click="clear_new_prescription()">
                                <md-option v-for="medication in medications" :value="medication.name">
                                    {{ medication.name }}
                                </md-option>
                            </md-select>
                        </md-field>
                    </div>
                    <div class="md-layout-item">
                        <md-field>
                            <label>Dosage</label>
                            <md-select v-model="new_prescription.dosage">
                                <md-option v-for="dosage in get_dosages()" :value="dosage">
                                    {{ dosage }}
                                </md-option>
                            </md-select>
                        </md-field>
                    </div>
                    <div class="md-layout-item">
                        <md-field>
                            <label>Quantity</label>
                            <md-select v-model="new_prescription.quantity">
                                <md-option v-for="quantity in get_quantities()" :value="quantity">
                                    {{ quantity }}
                                </md-option>
                            </md-select>
                        </md-field>
                        <md-field>
                            {{new_prescription.name}} {{new_prescription.dosage}} {{new_prescription.quantity}}
                        </md-field>
                    </div>

                </md-dialog-content>

                <md-dialog-actions>
                    <md-button class="md-primary" @click="showDialog = false">Close</md-button>
                    <md-button class="md-primary" @click="new_receipt()">Save</md-button>
                </md-dialog-actions>

            </md-dialog>
        </md-app-content>
    </md-app>

    <!-- Floating action buttons, shown only if patient is signed in. -->
    <template v-if="patient.is_signed_in">
        <md-button v-if="patient" class="md-fab md-primary" style="position: absolute; bottom: 15px; right: 15px;"
                   v-on:click="showDialog = true">
            <md-icon>add</md-icon>
        </md-button>
        <md-button v-if="patient" class="md-fab md-raised" style="position: absolute; bottom: 15px; right: 85px;"
                   v-on:click="clear_patient()">
            <md-icon>clear</md-icon>
        </md-button>
    </template>

</div>